<?php
// Mengimpor koneksi database
include 'connect.php';

// Data Latitude dan Longitude yang diberikan
$locations = [
    [-7.957558, 112.637908],
    [-7.938614, 112.633971],
    [-7.939465, 112.635213],
    [-7.941283, 112.638155],
    [-7.939279, 112.632211],
    [-7.855485, 112.496263],
    [-7.875104, 112.530469],
    [-7.870148, 112.526848],
    [-7.871699, 112.527039],
    [-7.871522, 112.527778],
    [-7.871198, 112.527717],
    [-7.871674, 112.526583],
    [-7.954782, 112.633471],
    [-7.910231, 112.632136],
    [-7.923359, 112.650982],
    [-7.94966, 112.631722],
    [-7.953831, 112.645681],
    [-7.952804, 112.638552],
    [-7.888553, 112.514161],
    [-7.95386, 112.645728],
    [-7.944182, 112.620169],
    [-7.944199, 112.620182],
    [-7.87172, 112.526431],
    [-7.941191, 112.651509],
    [-7.961209, 112.655593],
    [-7.870438, 112.519563],
    [-7.953004, 112.642205],
    [-7.902585, 112.562561],
    [-7.894098, 112.552295],
    [-7.948188, 112.656667],
    [-7.939785, 112.657461],
    [-7.944509, 112.64993],
    [-7.862872, 112.528899],
    [-7.86296, 112.528879],
    [-7.939738, 112.624324],
    [-7.944272, 112.619282],
    [-7.871293, 112.527718],
    [-7.874639, 112.530201],
    [-7.937092, 112.626567],
    [-7.939437, 112.664566],
    [-7.940312, 112.662186],
    [-7.930565, 112.647898],
    [-7.843177, 112.698215],
    [-7.949932, 112.662576],
    [-7.936348, 112.635954],
    [-7.9376, 112.625549],
    [-7.900371, 112.662566],
    [-7.871328, 112.525143],
    [-7.948241, 112.611716],
    [-7.946368, 112.610985],
    [-7.946402, 112.618165],
    [-7.960789, 112.623158],
    [-7.947838, 112.617366],
    [-7.922185, 112.583273],
    [-7.938477, 112.625214],
    [-7.941336, 112.637752],
    [-7.952481, 112.68105],
    [-7.953136, 112.64277],
    [-7.940078, 112.638532],
    [-7.939775, 112.638465],
    [-7.939349, 112.638402],
    [-7.949015, 112.611619],
    [-7.963144, 112.635437],
    [-7.936724, 112.637834],
    [-7.897504, 112.697994],
    [-7.962444, 112.636801],
    [-7.963045, 112.625782],
    [-7.958253, 112.655999],
    [-7.942012, 112.638231],
    [-7.940719, 112.630052],
    [-7.898282, 112.620257]
];


// Loop untuk mengupdate kolom link berdasarkan data latitude dan longitude
foreach ($locations as $index => $location) {
    $lat = $location[0];
    $lng = $location[1];

    // Membuat link berdasarkan lat dan lng
    $link = "webgis.html?lat=$lat&lng=$lng";

    // Query untuk mengupdate kolom 'link' pada restoran tertentu
    $id = $index + 1; // Menyesuaikan ID restoran, bisa sesuaikan dengan logika ID yang Anda gunakan

    // Eksekusi query update
    $sql = "UPDATE restaurants SET link='$link' WHERE id=$id";
}

// Ambil data restoran dan tampilkan dalam tabel
$sql = "SELECT * FROM restaurants";
$result = $conn->query($sql);

if ($result->num_rows > 0) {
    while ($row = $result->fetch_assoc()) {
        echo "<tr>
                <td>" . $row['id'] . "</td>
                <td>" . $row['name'] . "</td>
                <td>" . $row['cuisine'] . "</td>
                <td>" . ($row['opening_hour'] ? $row['opening_hour'] : '-') . "</td>
                <td><a href='" . $row['link'] . "' target='_blank'>View on Map</a></td>
              </tr>";
    }
} else {
    echo "<tr><td colspan='5'>No data available</td></tr>";
}

// Menutup koneksi
$conn->close();
